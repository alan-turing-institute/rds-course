
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.2.3 Feature Engineering &#8212; Research Data Science</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.2.4 Data Manipulation" href="2-02-04-DataManipulation.html" />
    <link rel="prev" title="2.2.2 Modifying Columns and Indices" href="2-02-02-ModifyingColumnsAndIndices.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Research Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Welcome to The Alan Turing Institute’s Introduction to Research Data Science course
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 1: Introduction to Data Science
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../m1/overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m1/1.1-WhatIsDataScience.html">
   1.1 What is (research) data science?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m1/1.2-DataScienceProjectLifecycle.html">
   1.2 Research Data Science project lifecycle
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m1/1.3-EDIForDataScience.html">
   1.3 Equality, diversity and inclusion in data science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m1/1.4-CollaborationAndReproducibility.html">
   1.4 Collaboration and reproducibility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m1/hands-on.html">
   Module 1: Hands-on session
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 2: Handling data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2-overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="2-01-GettingLoading.html">
   2.1 Getting and Loading Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="2-01-01-WhereToFindData.html">
     2.1.1 Where to find data?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-01-02-LegalityAndEthics.html">
     2.1.2 Legality and Ethics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-01-03-PandasIntro.html">
     2.1.3 Pandas intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-01-04-DataSourcesAndFormats.html">
     2.1.4 Data Sources and Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-01-05-ControllingAccess.html">
     2.1.5 Controlling access
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="2-02-ExploringWrangling.html">
   2.2 Exploring and Wrangling Data
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="2-02-01-DataConsistency.html">
     2.2.1 Data Consistency
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-02-02-ModifyingColumnsAndIndices.html">
     2.2.2 Modifying Columns and Indices
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     2.2.3 Feature Engineering
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="2-02-04-DataManipulation.html">
     2.2.4 Data Manipulation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="2-02-04-01-TimeAndDateData.html">
       2.2.4.1 Time and Date Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="2-02-04-02-TextData.html">
       2.2.4.2 Text data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="2-02-04-03-CategoricalData.html">
       2.2.4.3 Categorical Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="2-02-04-04-ImageData.html">
       2.2.4.4 Image Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-02-05-PrivacyAndAnonymisation.html">
     2.2.5 Privacy and Anonymisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-02-06-LinkingDatasets.html">
     2.2.6 Linking Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-02-07-MissingData.html">
     2.2.7 Missing Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-hands-on.html">
   Module 2: Hands-on session
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 3: Data Visualisation &amp; Exploration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/3.1-FiguresGoneWrong.html">
   3.1 Figures gone wrong
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/3.2-RulesOfTheGame.html">
   3.2 Rules of the data visualisation game
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/3.3-Atlas0fVisualisations.html">
   3.3 Atlas of Visualisations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/3.4-StoryTelling.html">
   3.4 Storytelling with data visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/3.5-DataVisForExploration.html">
   3.5 Walkthrough: visualisation for data exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m3/hands-on.html">
   Module 3 hands-on session
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 4: Introduction to Modelling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../m4/overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m4/4.1_What_and_Why.html">
   4.1 The What and Why of Statistical Modelling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m4/4.2_Fitting_Models.html">
   4.2 Fitting (Regression) Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m4/4.3_Building_simple_model.html">
   4.3 Building a simple model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m4/4.4_Evaluating_a_model.html">
   4.4 Evaluating models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../m4/hands-on.html">
   Module 4 hands-on session
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/modules/m2/2-02-03-FeatureEngineering.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/alan-turing-institute/rds-course"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/alan-turing-institute/rds-course/issues/new?title=Issue%20on%20page%20%2Fmodules/m2/2-02-03-FeatureEngineering.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/alan-turing-institute/rds-course/develop?urlpath=tree/coursebook/modules/m2/2-02-03-FeatureEngineering.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scaling-transforming-features">
   Scaling &amp; Transforming Features
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#converting-units">
     Converting Units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#normalisation">
     Normalisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standardisation">
     Standardisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformation">
     Transformation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-new-features">
   Creating New Features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#binning">
   Binning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-selection-and-dimensionality-reduction">
   Feature Selection and Dimensionality Reduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipelines">
   Pipelines
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="feature-engineering">
<h1>2.2.3 Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">¶</a></h1>
<p>What we’ve seen so far is how to load data into a Pandas data frame and perform some initial exploration and sanity checks to verify it looks how we expect. Following that, it’s still unlikely the data will be ready to be fed straight into an analysis or model so we must mould it to fit our needs.</p>
<p>This is what we’ll focus on for most of the rest of this module. In the literature you’ll find it referred to as “preprocessing”, “wrangling”, “feature engineering” and many other terms, which all cover some aspect of curating and manipulating the raw source data. In this section we focus on numerical data, but we discuss approaches for other types of data in later sections.</p>
<p>Here we’ll be using data from the Anthropometric Survey of US Army Personnel (<a class="reference external" href="https://www.openlab.psu.edu/ansur2/">ANSUR 2</a>), which includes comprehensive body shape and size measurements for people in the US army that were taken in 2012 and released publicly in 2017. There’s data on both males and females, we’ll use the female data here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/ANSUR_II_FEMALE_Public.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1986 entries, 0 to 1985
Columns: 108 entries, SubjectId to WritingPreference
dtypes: int64(99), object(9)
memory usage: 1.6+ MB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SubjectId</th>
      <th>abdominalextensiondepthsitting</th>
      <th>acromialheight</th>
      <th>acromionradialelength</th>
      <th>anklecircumference</th>
      <th>axillaheight</th>
      <th>balloffootcircumference</th>
      <th>balloffootlength</th>
      <th>biacromialbreadth</th>
      <th>bicepscircumferenceflexed</th>
      <th>...</th>
      <th>Branch</th>
      <th>PrimaryMOS</th>
      <th>SubjectsBirthLocation</th>
      <th>SubjectNumericRace</th>
      <th>Ethnicity</th>
      <th>DODRace</th>
      <th>Age</th>
      <th>Heightin</th>
      <th>Weightlbs</th>
      <th>WritingPreference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10037</td>
      <td>231</td>
      <td>1282</td>
      <td>301</td>
      <td>204</td>
      <td>1180</td>
      <td>222</td>
      <td>177</td>
      <td>373</td>
      <td>315</td>
      <td>...</td>
      <td>Combat Support</td>
      <td>92Y</td>
      <td>Germany</td>
      <td>2</td>
      <td>NaN</td>
      <td>2</td>
      <td>26</td>
      <td>61</td>
      <td>142</td>
      <td>Right hand</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10038</td>
      <td>194</td>
      <td>1379</td>
      <td>320</td>
      <td>207</td>
      <td>1292</td>
      <td>225</td>
      <td>178</td>
      <td>372</td>
      <td>272</td>
      <td>...</td>
      <td>Combat Service Support</td>
      <td>25U</td>
      <td>California</td>
      <td>3</td>
      <td>Mexican</td>
      <td>3</td>
      <td>21</td>
      <td>64</td>
      <td>120</td>
      <td>Right hand</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10042</td>
      <td>183</td>
      <td>1369</td>
      <td>329</td>
      <td>233</td>
      <td>1271</td>
      <td>237</td>
      <td>196</td>
      <td>397</td>
      <td>300</td>
      <td>...</td>
      <td>Combat Service Support</td>
      <td>35D</td>
      <td>Texas</td>
      <td>1</td>
      <td>NaN</td>
      <td>1</td>
      <td>23</td>
      <td>68</td>
      <td>147</td>
      <td>Right hand</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10043</td>
      <td>261</td>
      <td>1356</td>
      <td>306</td>
      <td>214</td>
      <td>1250</td>
      <td>240</td>
      <td>188</td>
      <td>384</td>
      <td>364</td>
      <td>...</td>
      <td>Combat Service Support</td>
      <td>25U</td>
      <td>District of Columbia</td>
      <td>8</td>
      <td>Caribbean Islander</td>
      <td>2</td>
      <td>22</td>
      <td>66</td>
      <td>175</td>
      <td>Right hand</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10051</td>
      <td>309</td>
      <td>1303</td>
      <td>308</td>
      <td>214</td>
      <td>1210</td>
      <td>217</td>
      <td>182</td>
      <td>378</td>
      <td>320</td>
      <td>...</td>
      <td>Combat Arms</td>
      <td>42A</td>
      <td>Texas</td>
      <td>1</td>
      <td>NaN</td>
      <td>1</td>
      <td>45</td>
      <td>63</td>
      <td>195</td>
      <td>Right hand</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 108 columns</p>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s also an interesting example of data documentation, with over 250 pages of notes on how the measurements were taken in its <a class="reference external" href="http://tools.openlab.psu.edu/publicData/ANSURII-TR11-017.pdf">Measurer’s Handbook</a>, for example.</p>
</div>
<div class="section" id="scaling-transforming-features">
<h2>Scaling &amp; Transforming Features<a class="headerlink" href="#scaling-transforming-features" title="Permalink to this headline">¶</a></h2>
<p>It’s common to need to map the original feature values in a dataset on to a different scale, either to improve their “human” interpretability (for yourself or others you’re presenting results to), or what we could call their “model interpretability” (converting values to be more compatible with the design and assumptions of a particular algorithm). Here we show how some frequently used operations can be performed with Pandas.</p>
<div class="section" id="converting-units">
<h3>Converting Units<a class="headerlink" href="#converting-units" title="Permalink to this headline">¶</a></h3>
<p>Despite the name, the <code class="docutils literal notranslate"><span class="pre">weightkg</span></code> column in the ANSUR 2 dataset is in units of 100 grams (tenths of a kilogram):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1986.000000
mean      677.582075
std       109.846458
min       358.000000
25%       601.000000
50%       668.000000
75%       745.750000
max      1196.000000
Name: weightkg, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">stature</span></code> (the person’s height) column is in millimetres:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1986.000000
mean     1628.473313
std        64.199512
min      1409.000000
25%      1586.250000
50%      1626.000000
75%      1672.000000
max      1829.000000
Name: stature, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>For interpreting the data ourselves and presenting it to others it’s helpful to have values on scales we’re familiar with. It’s quick to perform simple mathematical operations on columns with Pandas - let’s convert the <code class="docutils literal notranslate"><span class="pre">weightkg</span></code> column to actually be in kilograms, and the <code class="docutils literal notranslate"><span class="pre">stature</span></code> column to be in metres:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># 100g -&gt; kg</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median weight:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="s2">&quot;kg&quot;</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># mm -&gt; metres</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median height:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Median weight: 66.8 kg
Median height: 1.626 m
</pre></div>
</div>
</div>
</div>
<p>These look more familiar (at least if you’re used to using the metric system!) We can also see that women in the army are lighter and taller on average compared to the general population (<a class="reference external" href="https://www.cdc.gov/nchs/data/series/sr_03/sr03-046-508.pdf">73.1 kg median weight and 1.613 metres median height</a>), so we’d need to be careful not to generalise results from this data to the USA as a whole.</p>
</div>
<div class="section" id="normalisation">
<h3>Normalisation<a class="headerlink" href="#normalisation" title="Permalink to this headline">¶</a></h3>
<p>We’ll often have features that are on different scales (magnitudes). For example the axilla (armpit) height and ankle circumference in this dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a formatted message with the minimum, maximum, mean, and</span>
<span class="sd">    standard deviation of a pandas series&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;min = </span><span class="si">{:.2f}</span><span class="s2">, max = </span><span class="si">{:.2f}</span><span class="s2">, mean = </span><span class="si">{:.2f}</span><span class="s2">, std = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="n">series</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="n">series</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
    <span class="p">)</span>


<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;anklecircumference&quot;</span><span class="p">,</span> <span class="s2">&quot;axillaheight&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original:
anklecircumference : min = 170.00, max = 275.00, mean = 215.74, std = 14.89
axillaheight : min = 1038.00, max = 1419.00, mean = 1239.03, std = 55.80
</pre></div>
</div>
</div>
</div>
<p>The maximum axilla height is 1419 mm, and the biggest ankle only 275 mm in circumference. Having features with different magnitudes can have unintended consequences for some algorithms, such as those that use a metric of similarity between data points (like <a class="reference external" href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm">k-nearest neighbours</a>), for example. Say we wanted to compute how “similar” someome with the largest ankle circumference and axilla height was to the “average” person in those columns. Algorithms like these will often compute a metric like:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
(\mathrm{ankle}_{max} - \mathrm{ankle}_{mean})^2 + (\mathrm{axilla}_{max} - \mathrm{axilla}_{mean})^2 \\
(275.00 - 215.74)^2 + (1419.00 - 1239.03)^2 \\
59.26^2 + 179.97^2 \\
\simeq 3512 + 32389
\end{split}\]</div>
<p>Note that the axilla height ends up contributing almost 10 times more to the similarity metric, but only because it’s  a measurement of a larger distance. We probably intended differences in ankle size and armpit height to contribute equally.</p>
<p>One common way to solve this is to min-max scale, or “normalise” the data, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">norm_min_max</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Min-max scale a pandas series&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">series</span> <span class="o">-</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min-max scaled:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_min_max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Min-max scaled:
anklecircumference : min = 0.00, max = 1.00, mean = 0.44, std = 0.14
axillaheight : min = 0.00, max = 1.00, mean = 0.53, std = 0.15
</pre></div>
</div>
</div>
</div>
<p>With this scaling applied both columns have a minimum value of 0 and a maximum of 1, and so they become relative measurements of how close someone is to the largest value for each feature.</p>
</div>
<div class="section" id="standardisation">
<h3>Standardisation<a class="headerlink" href="#standardisation" title="Permalink to this headline">¶</a></h3>
<p>Another popular scaling approach is to “standardise” the data, or transform it so the feature has a mean of zero and a standard deviation of one, which can be achieved by subtracting the original mean and dividing by the original standard deviation of the feature:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Standardise a pandas series to have zero mean and unit</span>
<span class="sd">    standard deviation&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">series</span> <span class="o">-</span> <span class="n">series</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>


<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;footlength&quot;</span><span class="p">,</span> <span class="s2">&quot;earlength&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Standardised:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original:
footlength : min = 198.00, max = 286.00, mean = 246.29, std = 12.44
earlength : min = 46.00, max = 74.00, mean = 59.36, std = 3.88

Standardised:
footlength : min = -3.88, max = 3.19, mean = -0.00, std = 1.00
earlength : min = -3.44, max = 3.77, mean = -0.00, std = 1.00
</pre></div>
</div>
</div>
</div>
<p>Note that although both columns have the same mean and standard deviation after the transformation, they have different minimum and maximum values. Alternatively, after <em>normalisation</em> the features have the same minimum and maximum values but different means and standard deviations.</p>
<p>One key consequence of the different approaches is that standardisation preserves outliers (the range of the values is not restricted), whilst normalisation forces each feature to lie within the same range. Which is more appropriate depends on the use case(and you may want to try both and see which performs better).</p>
</div>
<div class="section" id="transformation">
<h3>Transformation<a class="headerlink" href="#transformation" title="Permalink to this headline">¶</a></h3>
<p>Let’s have a look at the distribution of ages in the ANSUR 2 data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Age: Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;Age&#39;)
</pre></div>
</div>
<img alt="../../_images/2-02-03-FeatureEngineering_20_1.png" src="../../_images/2-02-03-FeatureEngineering_20_1.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Plotting and visualisation is the focus of Module 3, so we won’t discuss the details of how to create plots here.</p>
</div>
<p>We see the majority of people are young adults under 35, but there is a long tail of older personnel up to around 60 years old. Some statistical analyses and models make assumptions about the data being normally distributed, or otherwise may perform poorly when long tails/outliers are present. In these cases one option is to log transform the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">log_age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Age: Log Transformed&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;log(Age)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;log(Age)&#39;)
</pre></div>
</div>
<img alt="../../_images/2-02-03-FeatureEngineering_22_1.png" src="../../_images/2-02-03-FeatureEngineering_22_1.png" />
</div>
</div>
<p>This has the effect of reducing the skewness of the distribution and making it “more normal”. Whether this, or another transformation, is appropriate for your analysis is a nuanced topic beyond the scope of this course. <a class="reference external" href="https://data.library.virginia.edu/interpreting-log-transformations-in-a-linear-model/">Here’s a longer discussion</a> on the consequences of log transforming data. Another popular algorithm for improving the normality of data is the <a class="reference external" href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda336.htm">Box-Cox transformation</a>.</p>
</div>
</div>
<div class="section" id="creating-new-features">
<h2>Creating New Features<a class="headerlink" href="#creating-new-features" title="Permalink to this headline">¶</a></h2>
<p>Another common task is to use domain knowledge to create new features that may be of interest for an analysis, or could add predictive power to a model. For this dataset it may be useful to compute the body mass index of the army personnel, for example, the formula for which is:</p>
<div class="math notranslate nohighlight">
\[
\textrm{BMI} = \frac{\textrm{weight}}{\textrm{height}^2}
\]</div>
<p>with weight in kilograms and height in metres. It’s quick to do this with Pandas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1986.000000
mean       25.495970
std         3.491673
min        16.366156
25%        23.077535
50%        25.266752
75%        27.609363
max        40.778999
Name: bmi, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>To apply an arbitrary function to a Pandas data frame you can also use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html"><code class="docutils literal notranslate"><span class="pre">apply</span></code></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_bmi</span><span class="p">(</span><span class="n">person</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate body mass index from  a person&#39;s data.</span>
<span class="sd">    Person is a pandas series which must include &#39;weightkg&#39; and &#39;stature&#39; in its index.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">person</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">person</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>


<span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_bmi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       26.997041
1       19.262506
2       22.647148
3       28.378575
4       35.853259
          ...    
1981    29.234331
1982    27.558173
1983    28.193653
1984    24.201059
1985    22.652319
Length: 1986, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> the function will be applied to each row in the data frame, or with <code class="docutils literal notranslate"><span class="pre">axis=0</span></code> to each column.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">apply</span></code> works like using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop on the data, which means it doesn’t benefit from the optimised vector operations <code class="docutils literal notranslate"><span class="pre">numpy</span></code> provides:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_bmi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>32 ms ± 862 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;weightkg&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;stature&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>177 µs ± 834 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</pre></div>
</div>
</div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">apply</span></code> is almost two hundred times slower (the exact ratio will vary depending on your system), and for larger datasets or more complex functions this can add up to a lot of time! We cover ways to make Python code run faster in more detail in the “Programming for Speed” module of our <a class="reference external" href="https://alan-turing-institute.github.io/rsd-engineeringcourse/html/index.html">Research Software Engineering course</a>, but it’s better to avoid using <code class="docutils literal notranslate"><span class="pre">apply</span></code> if you can.</p>
<p>As well as curating domain-specific features, another option is to generate many possible combinations of the original columns, and then perhaps select a subset of promising ones after further analysis (see feature selection below). The <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.PolynomialFeatures.html#sklearn.preprocessing.PolynomialFeatures"><code class="docutils literal notranslate"><span class="pre">PolynomialFeatures</span></code></a> class in the scikit-learn library generates features that are polynomial combinations of the original features (<code class="docutils literal notranslate"><span class="pre">weight</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">weight^2</span></code>, <code class="docutils literal notranslate"><span class="pre">height^2</span></code>, <code class="docutils literal notranslate"><span class="pre">weight</span> <span class="pre">*</span> <span class="pre">height</span></code>, …), for example.</p>
<p>Which columns and functions to use and combine into new features is problem-specific and there’s no one-size-fits-all solution.</p>
</div>
<div class="section" id="binning">
<h2>Binning<a class="headerlink" href="#binning" title="Permalink to this headline">¶</a></h2>
<p>Binning is the process of converting a column of continuous values into a discrete set of categories, such as mapping a person’s age to an age range (or age “bin”):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Age</p></th>
<th class="head"><p>Age Range</p></th>
<th class="head"><p>Bin Index</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>24</p></td>
<td><p>20-29</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>45</p></td>
<td><p>40-49</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>37</p></td>
<td><p>30-39</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>52</p></td>
<td><p>50-59</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>28</p></td>
<td><p>20-29</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>44</p></td>
<td><p>40-49</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p>To incorporate the bins in an analysis we usually give them an ordered index from bins with the smallest values (0, meaning an age between 20-29 above) to the largest values (3, meaning an age between 50-59 above).</p>
<p>There are several scenarios where binning may be useful:</p>
<ul class="simple">
<li><p>To create domain-relevant categories relevant for your research question. You may be interested in differences between children, adults and the elderly, for example, rather than between specific ages.</p></li>
<li><p>As a way of dealing with outliers. Biases caused by data with unusually large (or small) values may be mitigated be grouping extreme values in a single bin.</p></li>
<li><p>In some cases using binned data could improve the performance of a model (it may help to reduce <a class="reference external" href="https://en.wikipedia.org/wiki/Overfitting">overfitting</a>, for example).</p></li>
</ul>
<p>To show how binning works in Pandas we’ll use the arm span data (<code class="docutils literal notranslate"><span class="pre">span</span></code> column) in ANSUR 2, which has this distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_span_dist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the distribution of arm span and show the location of bins, if given</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># add a vertical line at each bin edge</span>
        <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">]</span>
        <span class="c1"># add bin index labels</span>
        <span class="p">[</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Bin</span><span class="se">\n</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">edge</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">325</span><span class="p">),</span>
                <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="c1"># add shading for each bin width</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="p">[</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Arm Span [mm]&quot;</span><span class="p">)</span>
    
<span class="n">plot_span_dist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2-02-03-FeatureEngineering_33_0.png" src="../../_images/2-02-03-FeatureEngineering_33_0.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Again, don’t worry about the details of this plotting function for now, we’ll be looking at that in Module 3.</p>
</div>
<p>Pandas provides a binning function <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html"><code class="docutils literal notranslate"><span class="pre">pd.cut</span></code></a>, which by default segments the data into a number of equal-width bins:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The second argument, 5, is the number of bins to segment the data into.</span>
<span class="c1"># Setting &#39;retbins=True&#39; returns an array of bin edges that we use for plotting below.</span>
<span class="n">span_bins</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">span_bins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       (1569.0, 1692.0]
1       (1692.0, 1815.0]
2       (1692.0, 1815.0]
3       (1692.0, 1815.0]
4       (1692.0, 1815.0]
              ...       
1981    (1692.0, 1815.0]
1982    (1569.0, 1692.0]
1983    (1692.0, 1815.0]
1984    (1569.0, 1692.0]
1985    (1569.0, 1692.0]
Name: span, Length: 1986, dtype: category
Categories (5, interval[float64, right]): [(1322.385, 1446.0] &lt; (1446.0, 1569.0] &lt; (1569.0, 1692.0] &lt; (1692.0, 1815.0] &lt; (1815.0, 1938.0]]
</pre></div>
</div>
</div>
</div>
<p>This returns a Pandas series with a “category” data type (see <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html">here</a> for more information). Each value in the data is assigned to the bin (or category) whose range encompasses it, with each bin labelled as <code class="docutils literal notranslate"><span class="pre">(minimum</span> <span class="pre">value,</span> <span class="pre">maximum</span> <span class="pre">value]</span></code> (which is a bin including values <code class="docutils literal notranslate"><span class="pre">minimum</span> <span class="pre">&lt;</span> <span class="pre">x</span> <span class="pre">&lt;=</span> <span class="pre">maximum</span></code>). The bins span all values from the minimum to the maximum arm span, and each bin has the same width:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_span_dist</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2-02-03-FeatureEngineering_38_0.png" src="../../_images/2-02-03-FeatureEngineering_38_0.png" />
</div>
</div>
<p>Rather than the verbose bin label seen in the result from <code class="docutils literal notranslate"><span class="pre">pd.cut</span></code> above, you can also extract a bin index (ranked from smallest to largest) using the <code class="docutils literal notranslate"><span class="pre">.cat.codes</span></code> attribute:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">span_bins</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       2
1       3
2       3
3       3
4       3
       ..
1981    3
1982    2
1983    3
1984    2
1985    2
Length: 1986, dtype: int8
</pre></div>
</div>
</div>
</div>
<p>We talk more about categorical data in a later section. Pandas also provides an alternative binning function, <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.qcut.html"><code class="docutils literal notranslate"><span class="pre">pd.qcut</span></code></a>, which creates bins based on quantiles. In this case each bin contains approximately the same proportion of the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">span_qbins</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">span_qbins</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1322.999, 1591.0]    404
(1591.0, 1636.0]      396
(1636.0, 1678.0]      398
(1678.0, 1728.0]      391
(1728.0, 1938.0]      397
Name: span, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>And to achieve this the bins must have different widths (being narrower in the central portion of the distribution):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_span_dist</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2-02-03-FeatureEngineering_44_0.png" src="../../_images/2-02-03-FeatureEngineering_44_0.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can customise <code class="docutils literal notranslate"><span class="pre">pd.cut</span></code> and <code class="docutils literal notranslate"><span class="pre">pd.qcut</span></code> to return bins of any width or bins for any quantile respectively by passing an array of bin edges as their second argument, for example <code class="docutils literal notranslate"><span class="pre">pd.cut(df[&quot;span&quot;],</span> <span class="pre">[1300,</span> <span class="pre">1600,</span> <span class="pre">1700,</span> <span class="pre">2000])</span></code>, see the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html">Pandas documentation</a> for details.</p>
</div>
</div>
<div class="section" id="feature-selection-and-dimensionality-reduction">
<h2>Feature Selection and Dimensionality Reduction<a class="headerlink" href="#feature-selection-and-dimensionality-reduction" title="Permalink to this headline">¶</a></h2>
<p>It’s beyond the scope of what we cover here, but another important topic is the “curse of dimensionality”, or what to do when we have many features (columns) relative to the number of samples (rows) in the dataset. <a class="reference external" href="http://blog.dominodatalab.com/the-curse-of-dimensionality">This blog post</a> summarises how this can cause problems in some models.</p>
<p>Broadly speaking there are three techniques that can be used when this is a problem:</p>
<ul class="simple">
<li><p><strong>Feature selection:</strong> Only include a subset of the available features in the model, keeping those that are the strongest predictors for the target variable. Scikit-learn has some algorithms for feature selection available, see <a class="reference external" href="https://scikit-learn.org/stable/modules/feature_selection.html">here</a>.</p></li>
<li><p><strong>Dimensionality reduction:</strong> Condense the original features into a smaller number of new features (each one being a function/combination of the original features) that maintain important relationships in the data. The most well-known technique here is <a class="reference external" href="https://en.wikipedia.org/wiki/Principal_component_analysis">Principal Component Analysis</a>, which also has a <a class="reference external" href="https://scikit-learn.org/stable/modules/decomposition.html#pca">scikit-learn implementation</a>.</p></li>
<li><p><strong>Regularisation:</strong> Modifies the “cost function” of a model to penalise complexity (i.e. preferring solutions that give a large weighting to a smaller number of features). <a class="reference external" href="https://programmathically.com/regularization-in-machine-learning/">See this blog post</a> for more details.</p></li>
</ul>
</div>
<div class="section" id="pipelines">
<h2>Pipelines<a class="headerlink" href="#pipelines" title="Permalink to this headline">¶</a></h2>
<p>We’ve shown how to quickly perform various feature engineering techniques in Pandas, but it’s important to consider how to integrate these into a modelling or analysis pipeline. In particular, any transformations you use whilst training a model should be saved so they can later be re-used to test the model on new data. There are other libraries and frameworks which can help you do this more efficiently, such as <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> (see the <a class="reference external" href="https://scikit-learn.org/stable/data_transforms.html">Dataset transformations  section</a> of the user guide).</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "alan-turing-institute/rds-course",
            ref: "develop",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./modules/m2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="2-02-02-ModifyingColumnsAndIndices.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2.2.2 Modifying Columns and Indices</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2-02-04-DataManipulation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2.2.4 Data Manipulation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Research Engineering Group, The Alan Turing Institute<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>